<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<VBox xmlns="http://javafx.com/javafx/21"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.example.payroll_project.controller.AttendanceController"
      spacing="24">
    
    <!-- Page Header -->
    <HBox alignment="CENTER_LEFT" spacing="20">
        <VBox spacing="4">
            <Label text="Attendance Management" styleClass="card-title" style="-fx-font-size: 28px;"/>
            <Label text="Import and manage attendance records from FA2000 biometric scanner (CR1)" 
                   styleClass="card-subtitle"/>
        </VBox>
        
        <Region HBox.hgrow="ALWAYS"/>
        
        <HBox spacing="10">
            <Button text="ðŸ“¥ Import FA2000 CSV" styleClass="button-primary" 
                    onAction="#handleImportCSV"
                    style="-fx-padding: 10px 20px; -fx-font-size: 14px;"/>
            <Button text="ðŸ“Š Export Report" styleClass="button-secondary" 
                    onAction="#handleExport"/>
        </HBox>
    </HBox>

    <!-- Statistics Cards -->
    <GridPane hgap="20" vgap="20">
        <columnConstraints>
            <ColumnConstraints percentWidth="25"/>
            <ColumnConstraints percentWidth="25"/>
            <ColumnConstraints percentWidth="25"/>
            <ColumnConstraints percentWidth="25"/>
        </columnConstraints>
        
        <VBox styleClass="stat-card" spacing="12" GridPane.columnIndex="0">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="ðŸ“¥" style="-fx-font-size: 24px;"/>
                <Label text="Last Import" styleClass="stat-label"/>
            </HBox>
            <Label fx:id="lastImportLabel" text="No imports yet" 
                   style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #374151;"/>
            <Label fx:id="lastImportDateLabel" text="-" styleClass="card-subtitle"/>
        </VBox>
        
        <VBox styleClass="stat-card" spacing="12" GridPane.columnIndex="1">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="âœ…" style="-fx-font-size: 24px;"/>
                <Label text="Valid Records" styleClass="stat-label"/>
            </HBox>
            <Label fx:id="validRecordsLabel" text="0" styleClass="stat-value" 
                   style="-fx-text-fill: #10B981;"/>
            <Label text="Records processed" styleClass="card-subtitle"/>
        </VBox>
        
        <VBox styleClass="stat-card" spacing="12" GridPane.columnIndex="2">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="âš ï¸" style="-fx-font-size: 24px;"/>
                <Label text="Anomalies Detected" styleClass="stat-label"/>
            </HBox>
            <Label fx:id="anomaliesLabel" text="0" styleClass="stat-value"
                   style="-fx-text-fill: #F59E0B;"/>
            <Label text="Requires attention (F3)" styleClass="card-subtitle"/>
        </VBox>
        
        <VBox styleClass="stat-card" spacing="12" GridPane.columnIndex="3">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="ðŸ“Š" style="-fx-font-size: 24px;"/>
                <Label text="Attendance Rate" styleClass="stat-label"/>
            </HBox>
            <Label fx:id="attendanceRateLabel" text="0%" styleClass="stat-value"
                   style="-fx-text-fill: #3B82F6;"/>
            <Label text="Present vs Total" styleClass="card-subtitle"/>
        </VBox>
    </GridPane>

    <!-- Date Filter Section -->
    <VBox styleClass="card" spacing="16">
        <Label text="ðŸ“… Filter by Date Range" styleClass="card-title" style="-fx-font-size: 16px;"/>
        <HBox spacing="12" alignment="CENTER_LEFT">
            <DatePicker fx:id="startDatePicker" promptText="Start Date"
                       style="-fx-pref-width: 150px;"/>
            <Label text="to" style="-fx-font-weight: 600;"/>
            <DatePicker fx:id="endDatePicker" promptText="End Date"
                       style="-fx-pref-width: 150px;"/>
            
            <Button text="Apply" styleClass="button-primary" 
                   onAction="#handleApplyDateFilter"
                   style="-fx-padding: 8px 16px;"/>
            <Button text="Today" styleClass="button-secondary" 
                   onAction="#handleFilterToday"/>
            <Button text="This Week" styleClass="button-secondary" 
                   onAction="#handleFilterThisWeek"/>
            <Button text="This Month" styleClass="button-secondary" 
                   onAction="#handleFilterThisMonth"/>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <CheckBox fx:id="showAnomaliesOnly" 
                      text="Show Anomalies Only"
                      onAction="#handleFilterAnomalies"
                      style="-fx-font-weight: 600;"/>
        </HBox>
    </VBox>

    <!-- Attendance Records Table -->
    <VBox styleClass="card" spacing="16" VBox.vgrow="ALWAYS">
        <HBox styleClass="card-header" alignment="CENTER_LEFT" spacing="15">
            <VBox spacing="4">
                <Label text="Attendance Records" styleClass="card-title"/>
                <Label fx:id="recordCountLabel" text="0 records" styleClass="card-subtitle"/>
            </VBox>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <Button text="âœ“ Validate All" styleClass="button-secondary" 
                    onAction="#handleValidateAll"/>
            <Button text="ðŸ”„ Refresh" styleClass="button-secondary" 
                    onAction="#handleRefresh"/>
        </HBox>
        
        <TableView fx:id="attendanceTable" VBox.vgrow="ALWAYS"
                  style="-fx-min-height: 400px;">
            <columns>
                <TableColumn fx:id="employeeCodeColumn" text="Emp. Code" prefWidth="90"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="employeeNameColumn" text="Employee Name" prefWidth="150"/>
                <TableColumn fx:id="dateColumn" text="Date" prefWidth="110"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="timeIn1Column" text="Time In" prefWidth="80"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="timeOut1Column" text="Lunch Out" prefWidth="80"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="timeIn2Column" text="Lunch In" prefWidth="80"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="timeOut2Column" text="Time Out" prefWidth="80"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="regularHoursColumn" text="Hours" prefWidth="70"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="overtimeColumn" text="OT Hrs" prefWidth="70"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="statusColumn" text="Status" prefWidth="100"
                            style="-fx-alignment: CENTER;"/>
                <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="140"
                            style="-fx-alignment: CENTER;"/>
            </columns>
            <placeholder>
                <VBox alignment="CENTER" spacing="15" style="-fx-padding: 60px;">
                    <Label text="ðŸ“‹" style="-fx-font-size: 48px;"/>
                    <Label text="No Attendance Records Found" 
                           style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #374151;"/>
                    <Label text="Import a CSV file from FA2000 biometric scanner to get started" 
                           styleClass="card-subtitle" style="-fx-font-size: 14px;"/>
                    <Button text="ðŸ“¥ Import FA2000 CSV Now" styleClass="button-primary" 
                            onAction="#handleImportCSV"
                            style="-fx-padding: 12px 24px; -fx-margin-top: 10px; -fx-font-size: 14px;"/>
                </VBox>
            </placeholder>
        </TableView>

        <!-- Pagination (Future Implementation) -->
        <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10px 0 0 0;">
            <Button text="â—€ Previous" styleClass="button-secondary" 
                   onAction="#handlePreviousPage" disable="true"/>
            <Label fx:id="pageLabel" text="Page 1 of 1" 
                  style="-fx-font-weight: 600; -fx-padding: 0 20px;"/>
            <Button text="Next â–¶" styleClass="button-secondary" 
                   onAction="#handleNextPage" disable="true"/>
        </HBox>
    </VBox>
    
    <!-- Import Instructions & Compliance Card -->
    <VBox styleClass="card" spacing="12" style="-fx-background-color: #EFF6FF; -fx-border-color: #3B82F6; -fx-border-width: 1px;">
        <HBox alignment="CENTER_LEFT" spacing="12">
            <Label text="â„¹ï¸" style="-fx-font-size: 24px;"/>
            <VBox spacing="8" HBox.hgrow="ALWAYS">
                <Label text="FA2000 CSV Import Instructions" 
                       style="-fx-font-weight: 600; -fx-text-fill: #1E40AF; -fx-font-size: 14px;"/>
                <Label text="1. Export attendance data from your FA2000 biometric scanner as CSV file" 
                       style="-fx-text-fill: #1E40AF; -fx-font-size: 12px;"/>
                <Label text="2. Click 'Import FA2000 CSV' button above and select the exported file" 
                       style="-fx-text-fill: #1E40AF; -fx-font-size: 12px;"/>
                <Label text="3. System will automatically process records and detect anomalies (F3: Intelligent Validation)" 
                       style="-fx-text-fill: #1E40AF; -fx-font-size: 12px;"/>
                <Label text="4. Review any detected anomalies (missing punches, incomplete data) and take corrective action" 
                       style="-fx-text-fill: #1E40AF; -fx-font-size: 12px;"/>
            </VBox>
        </HBox>
        
        <Separator style="-fx-background-color: #3B82F6;"/>
        
        <HBox alignment="CENTER_LEFT" spacing="12">
            <Label text="ðŸ”’" style="-fx-font-size: 20px;"/>
            <VBox spacing="6">
                <Label text="Data Privacy &amp; Compliance" 
                       style="-fx-font-weight: 600; -fx-text-fill: #1E40AF; -fx-font-size: 13px;"/>
                <Label text="âœ“ AES-256 Encryption (Data at Rest) | âœ“ TLS 1.3 (Data in Transit) | âœ“ Data Privacy Act 2012 Compliant" 
                       style="-fx-text-fill: #1E40AF; -fx-font-size: 11px;"/>
                <Label text="âœ“ Audit Trail Active (F6) | âœ“ 24-Hour Breach Notification | âœ“ DPO: Carl Andrei Tafalla" 
                       style="-fx-text-fill: #1E40AF; -fx-font-size: 11px;"/>
            </VBox>
        </HBox>
    </VBox>
    
    <!-- Supported CSV Format Notice -->
    <VBox styleClass="card" spacing="8" style="-fx-background-color: #F3F4F6; -fx-border-color: #D1D5DB; -fx-border-width: 1px;">
        <HBox alignment="CENTER_LEFT" spacing="10">
            <Label text="ðŸ“„" style="-fx-font-size: 18px;"/>
            <VBox spacing="4">
                <Label text="Supported CSV Format: FA2000 Attendance Report" 
                       style="-fx-font-weight: 600; -fx-text-fill: #374151; -fx-font-size: 12px;"/>
                <Label text="Expected columns: Date/Week, Time1 (In/Out), Time2 (In/Out), OT (In/Out) | 'Missed' entries are handled automatically" 
                       style="-fx-text-fill: #6B7280; -fx-font-size: 11px;"/>
            </VBox>
        </HBox>
    </VBox>
</VBox>
